var ze=Object.defineProperty,Te=Object.defineProperties;var Be=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var Ee=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable;var ue=(c,d,u)=>d in c?ze(c,d,{enumerable:!0,configurable:!0,writable:!0,value:u}):c[d]=u,$=(c,d)=>{for(var u in d||(d={}))Ee.call(d,u)&&ue(c,u,d[u]);if(de)for(var u of de(d))Me.call(d,u)&&ue(c,u,d[u]);return c},M=(c,d)=>Te(c,Be(d));var R=(c,d,u)=>new Promise((D,p)=>{var h=i=>{try{y(u.next(i))}catch(T){p(T)}},l=i=>{try{y(u.throw(i))}catch(T){p(T)}},y=i=>i.done?D(i.value):Promise.resolve(i.value).then(h,l);y((u=u.apply(c,d)).next())});import{b3 as me,b4 as L,d as se,h as P,at as G,a as z,o as b,e as a,B as ie,w as o,s as g,aY as te,F as J,r as Y,M as j,b as m,I as ce,f as q,a4 as le,aT as pe,h2 as De,c as ne,A as fe,aM as _e,x as Ae,k as He,aQ as Oe,b6 as Ne,a$ as je,b0 as qe,q as O,b7 as K,t as F,b1 as Fe,b8 as Le,_ as re,v as Re,j as Ge,aN as Je,aO as Ye,S as Qe,a7 as We,ao as Ze,ad as Xe,aU as Ke,aV as ea,ai as aa,aW as oa,a9 as ve,aX as ta,al as ee,h1 as la,aZ as na,a8 as sa,a_ as ia,p as ra,aa as da}from"./index-BLKh9tQK.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import{u as ge}from"./loading-CMzUFs6t.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */import{S as ua,c as ae}from"./sortable.esm-Cr8z2Vrv.js";function ma(c){return me.post(L("/v1/internal"),M($({},c),{action:"describe_goods"}))}function oe(c){return me.post(L("/v1/internal"),M($({},c),{action:"upsert_goods"}))}const ca={class:"product-params-modal"},pa={class:"product-params-modal-title product-params-modal"},fa={class:"operation"},_a={class:"operation"},va=se({__name:"productParamsModal",props:{modelValue:Object},emits:["update:modelValue"],setup(c,{emit:d}){const u=P(!1),D=c,p=P([{param_name:"",param_value:[{name:"",value:""}]}]),h=d,l=_=>{u.value=_},y=()=>{p.value.push({param_name:"",param_value:[{name:"",value:""}]})},i=_=>{p.value.splice(_,1)},T=_=>{p.value[_].param_value.push({name:"",value:""})},C=(_,f)=>{p.value[_].param_value.splice(f,1)};G(()=>D.modelValue,_=>{console.log("val:",_),_&&(p.value=JSON.parse(JSON.stringify(_)))},{immediate:!0});const B=()=>p.value.some(f=>!f.param_name||f.param_value.some(U=>!U.name||!U.value))?(j.error("参数不能为空"),!1):(console.log("paramsArr:",p.value),h("update:modelValue",p.value),!0);return(_,f)=>{const U=ie,A=ce,N=pe,H=De,t=te;return b(),z("div",ca,[a(U,{type:"outline",onClick:f[0]||(f[0]=()=>{l(!0)})},{default:o(()=>f[3]||(f[3]=[g(" 编辑参数 ")])),_:1}),a(t,{visible:u.value,"onUpdate:visible":f[2]||(f[2]=e=>u.value=e),title:"编辑参数",width:"500px","cancel-text":"取消","ok-text":"保存参数",onOk:B},{default:o(()=>[(b(!0),z(J,null,Y(p.value,(e,w)=>(b(),z("div",{key:w},[m("div",pa,[a(A,{modelValue:e.param_name,"onUpdate:modelValue":I=>e.param_name=I,modelModifiers:{sync:!0},placeholder:"参数大类"},null,8,["modelValue","onUpdate:modelValue"]),m("div",fa,[a(N,{class:"add-icon",onClick:f[1]||(f[1]=()=>{y()})}),p.value.length>1?(b(),q(H,{key:0,class:"del-icon",onClick:()=>{i(w)}},null,8,["onClick"])):le("",!0)])]),(b(!0),z(J,null,Y(e.param_value,(I,S)=>(b(),z("div",{key:S,class:"product-params-modal-sub-title product-params-modal"},[a(A,{modelValue:I.name,"onUpdate:modelValue":x=>I.name=x,placeholder:"参数小类",class:"parmas-value"},null,8,["modelValue","onUpdate:modelValue"]),a(A,{modelValue:I.value,"onUpdate:modelValue":x=>I.value=x,placeholder:"参数值",class:"parmas-value"},null,8,["modelValue","onUpdate:modelValue"]),m("div",_a,[a(N,{class:"add-icon",onClick:()=>{T(w)}},null,8,["onClick"]),e.param_value.length>1?(b(),q(H,{key:0,class:"del-icon",onClick:()=>{C(w,S)}},null,8,["onClick"])):le("",!0)])]))),128))]))),128))]),_:1},8,["visible"])])}}}),ga={class:"container"},ba={class:"wrapper"},ya={class:"btns"},xa={name:"Step"},wa=se(M($({},xa),{props:{productInfo:{type:Object,default(){return{}}}},emits:["cancelEdit","cancelHandle"],setup(c,{emit:d}){const{loading:u}=ge(!1),D=d,p=c,h=P(),l=P({name:"",category:"",model:"",desc:"",detail:"",product_params:[{param_name:"",param_value:[{name:"",value:""}]}]}),y=P({main_img:"",detail_img:"",doc:""}),i=P({main_img:[],detail_img:[],doc:[]}),T=ne(()=>{var t;return!!((t=p.productInfo)!=null&&t.id)});G(()=>p.productInfo,t=>{t!=null&&t.id&&(l.value={id:t.id,name:t.name,category:t.category,model:t.model,desc:t.desc,detail:t.detail,status:t.status,product_params:t.product_params||[{param_name:"",param_value:[{name:"",value:""}]}]},i.value={main_img:t.main_img||[],detail_img:t.detail_img||[],doc:t.doc||[]})},{immediate:!0});const C=()=>{D("cancelHandle")},B=(t,e)=>(console.log("onBeforeUpload:",t),y.value[e]=t.name,!0),_=(t,e)=>{console.log("onBeforeRemove:",t);const w=[];return i.value[e].forEach(I=>{I.indexOf(t.name)===-1&&w.push(I)}),i.value[e]=w,!0},f=(t,e)=>{const{response:w}=t;i.value[e].push(w.data.file_url),console.log("onUploadSuccess:",t)},U=t=>{console.log("onUploadError:",t)},A=t=>t.map(e=>({name:e,url:Le(e)})),N=t=>R(this,null,function*(){var e;if(t){if(console.log("formData:",h),yield(e=h.value)==null?void 0:e.validate()){j.error("填写内容有误，请检查");return}te.confirm({title:"发布活动",content:"是否确认发布活动？",titleAlign:"start",onOk:()=>{oe(M($({},l.value),{main_img:i.value.main_img,detail_img:i.value.detail_img,doc:i.value.doc,status:"online"})).then(I=>{j.success("发布成功"),C()})},onCanel:()=>{}})}else{if(console.log("formData:",l),!l.value.name){j.error("请填写产品名称");return}l.value.product_params[0].param_name||(l.value.product_params=null),oe(M($({},l.value),{main_img:i.value.main_img,detail_img:i.value.detail_img,doc:i.value.doc,status:l.value.status?l.value.status:"offline"})).then(w=>{j.success("保存成功"),C()})}}),H=()=>R(this,null,function*(){var e;if(console.log("formData:",l),yield(e=h.value)==null?void 0:e.validate()){j.error("填写内容有误，请检查");return}te.confirm({title:"下架商品",content:"是否确认下架商品？",titleAlign:"start",onOk:()=>{oe(M($({},l.value),{main_img:i.value.main_img,detail_img:i.value.detail_img,doc:i.value.doc,status:"offline"})).then(w=>{j.success("下线成功"),C()})},onCanel:()=>{}})});return(t,e)=>{const w=fe("Breadcrumb"),I=ce,S=He,x=Ne,Q=Oe,s=je,r=qe,V=Ae,E=_e,k=ie,W=Fe;return b(),z("div",ga,[a(w,{items:["商品管理",T.value?"商品详情":"创建商品"]},null,8,["items"]),a(W,{loading:O(u),style:{width:"100%"}},{default:o(()=>[a(E,{class:"general-card"},{title:o(()=>[g(F(T.value?"基本信息":"创建商品"),1)]),default:o(()=>[m("div",ba,[a(V,{ref_key:"formRef",ref:h,model:l.value,class:"form","label-col-props":{span:8},"label-align":"left","wrapper-col-props":{span:16}},{default:o(()=>[a(S,{field:"name",label:"商品名称",rules:[{required:!0,message:"填写商品名称"},{match:/^[a-z A-Z.0-9\u4e00-\u9fa5]{1,50}$/,message:"商品名称格式不正确"}]},{default:o(()=>[a(I,{modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=n=>l.value.name=n),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1}),a(S,{field:"category",label:"商品类别",rules:[{required:!0,message:"选择商品类别"}]},{default:o(()=>[a(Q,{modelValue:l.value.category,"onUpdate:modelValue":e[1]||(e[1]=n=>l.value.category=n),placeholder:"选择商品类别"},{default:o(()=>[a(x,null,{default:o(()=>e[11]||(e[11]=[g("Humanoid robot")])),_:1}),a(x,null,{default:o(()=>e[12]||(e[12]=[g("Industrial robot")])),_:1}),a(x,null,{default:o(()=>e[13]||(e[13]=[g("Agricultural robot")])),_:1}),a(x,null,{default:o(()=>e[14]||(e[14]=[g("Transport robot")])),_:1}),a(x,null,{default:o(()=>e[15]||(e[15]=[g("Security robot")])),_:1}),a(x,null,{default:o(()=>e[16]||(e[16]=[g("Commercial robot")])),_:1}),a(x,null,{default:o(()=>e[17]||(e[17]=[g("Healthcare robot")])),_:1}),a(x,null,{default:o(()=>e[18]||(e[18]=[g("Household robot")])),_:1}),a(x,null,{default:o(()=>e[19]||(e[19]=[g("Educational robot")])),_:1}),a(x,null,{default:o(()=>e[20]||(e[20]=[g("Entertainment robot")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a(S,{field:"model",label:"商品型号",rules:[{required:!0,message:"请填写商品型号"}]},{default:o(()=>[a(s,{modelValue:l.value.model,"onUpdate:modelValue":e[2]||(e[2]=n=>l.value.model=n),placeholder:"请填写商品型号","max-length":100,"show-word-limit":"","allow-clear":""},null,8,["modelValue"])]),_:1}),a(S,{field:"desc",label:"商品介绍",rules:[{required:!0,message:"请填写商品介绍"}]},{default:o(()=>[a(s,{modelValue:l.value.desc,"onUpdate:modelValue":e[3]||(e[3]=n=>l.value.desc=n),class:"more-content-cls",placeholder:"请填写商品介绍","max-length":1e3,"show-word-limit":"","allow-clear":""},null,8,["modelValue"])]),_:1}),a(S,{field:"main_img",label:"商品主图","row-class":"keep-margin",rules:[{required:!1,message:"选择商品主图"}]},{default:o(()=>[m("div",null,[a(r,{"list-type":"picture-card","image-preview":"",action:O(L)("/v1/internal"),headers:{Authorization:`Bearer ${O(K)()}`},accept:"image/png, image/jpeg, image/jpg",data:{action:"upload",filename:y.value.main_img},"default-file-list":A(i.value.main_img),"on-before-upload":n=>B(n,"main_img"),"on-before-remove":n=>_(n,"main_img"),onSuccess:e[4]||(e[4]=n=>f(n,"main_img")),onError:U},null,8,["action","headers","data","default-file-list","on-before-upload","on-before-remove"]),e[21]||(e[21]=m("div",{style:{"font-size":"12px","margin-top":"5px"}},"温馨提示：支持上传格式：PNG、JPG，文件大小不得超过20MB。",-1))])]),_:1}),e[24]||(e[24]=m("div",{style:{color:"#000","font-size":"16px",padding:"40px 0px"}},"商品详情",-1)),a(S,{field:"detail",label:"商品详细描述",rules:[{required:!0,message:"请填写商品详情"}]},{default:o(()=>[a(s,{modelValue:l.value.detail,"onUpdate:modelValue":e[5]||(e[5]=n=>l.value.detail=n),class:"more-content-cls",placeholder:"请填写商品详情","max-length":2e3,"show-word-limit":"","allow-clear":""},null,8,["modelValue"])]),_:1}),a(S,{field:"product_params",label:"商品参数",rules:[{required:!1,message:"请填写商品参数"}]},{default:o(()=>[a(va,{modelValue:l.value.product_params,"onUpdate:modelValue":e[6]||(e[6]=n=>l.value.product_params=n)},null,8,["modelValue"])]),_:1}),a(S,{field:"ownerQrcodeImg",label:"添加图片/视频","row-class":"keep-margin",rules:[{required:!1,message:"请上传图片/视频"}]},{default:o(()=>[m("div",null,[a(r,{action:O(L)("/v1/internal"),headers:{Authorization:`Bearer ${O(K)()}`},accept:`
                    image/png, image/jpeg, image/jpg, video/mp4, video/mov, video/gif, video/avi, video/swf, video/3gp, video/flv, video/webm`,data:{action:"upload",filename:y.value.detail_img},download:!0,"default-file-list":A(i.value.detail_img),"on-before-upload":n=>B(n,"detail_img"),"on-before-remove":n=>_(n,"detail_img"),onSuccess:e[7]||(e[7]=n=>f(n,"detail_img")),onError:U},null,8,["action","headers","data","default-file-list","on-before-upload","on-before-remove"]),e[22]||(e[22]=m("div",{style:{"font-size":"12px","margin-top":"5px"}}," 温馨提示：支持上传格式：PNG、JPG、JPEG，MP4、MOV、GIF、AVI、SWF、3GP、FLV、WEBM，文件大小不得超过100MB ",-1))])]),_:1}),a(S,{field:"ownerQrcodeImg",label:"添加文档","row-class":"keep-margin",rules:[{required:!1,message:"请上传添加文档"}]},{default:o(()=>[m("div",null,[a(r,{action:O(L)("/v1/internal"),headers:{Authorization:`Bearer ${O(K)()}`},download:!0,accept:`
                    application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document, application/vnd.ms-powerpoint, application/vnd.openxmlformats-officedocument.presentationml.presentation, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/pdf, text/plain`,data:{action:"upload",filename:y.value.doc},"default-file-list":A(i.value.doc),"on-before-upload":n=>B(n,"doc"),"on-before-remove":n=>_(n,"doc"),onSuccess:e[8]||(e[8]=n=>f(n,"doc")),onError:U},null,8,["action","headers","data","default-file-list","on-before-upload","on-before-remove"]),e[23]||(e[23]=m("div",{style:{"font-size":"12px","margin-top":"5px"}}," 温馨提示：支持上传文档格式：doc(.docx)、ppt(.pptx)、xls(.xlsx)、pdf、txt，文件大小不得超过100MB。 ",-1))])]),_:1})]),_:1},8,["model"])])]),_:1}),m("div",ya,[l.value.status!=="online"?(b(),q(k,{key:0,type:"primary",onClick:e[9]||(e[9]=()=>{N(!0)})},{default:o(()=>e[25]||(e[25]=[g(" 发布商品 ")])),_:1})):(b(),q(k,{key:1,type:"outline",onClick:H},{default:o(()=>e[26]||(e[26]=[g("下架活动")])),_:1})),a(k,{type:"outline",onClick:e[10]||(e[10]=()=>{N(!1)})},{default:o(()=>e[27]||(e[27]=[g(" 保存草稿 ")])),_:1}),a(k,{class:"cancel-btn",onClick:C},{default:o(()=>e[28]||(e[28]=[g("取消")])),_:1})])]),_:1},8,["loading"])])}}})),Va=re(wa,[["__scopeId","data-v-78f50c92"]]),ka={class:"container"},Ca={class:"action-icon"},Ia={class:"action-icon"},Sa={id:"tableSetting"},ha={style:{"margin-right":"4px",cursor:"move"}},Pa={class:"title"},Ua={name:"SearchTable"},$a=se(M($({},Ua),{props:{isRefresh:{type:Boolean,default(){return!1}}},emits:["doHandle"],setup(c,{emit:d}){const u=()=>({activityTime:[],activityStatus:""}),D=d,p=c,{loading:h,setLoading:l}=ge(!0),{t:y}=Re.useI18n(),i=P([]),T=P(u()),C=P([]),B=P([]),_=P("medium"),f={current:1,pageSize:20,total:0},U=Ge(M($({},f),{showTotal:(s,r)=>`${r[0]} - ${r[1]} of ${s} items`})),A=ne(()=>[{name:y("searchTable.size.mini"),value:"mini"},{name:y("searchTable.size.small"),value:"small"},{name:y("searchTable.size.medium"),value:"medium"},{name:y("searchTable.size.large"),value:"large"}]),N=ne(()=>[{title:"商品名称",dataIndex:"name"},{title:"商品类别",dataIndex:"category"},{title:"型号",dataIndex:"model",slotName:"model"},{title:"状态",dataIndex:"status",slotName:"productStatus"},{title:y("searchTable.columns.createdTime"),dataIndex:"updated_at",slotName:"updated_at"},{title:y("searchTable.columns.operations"),dataIndex:"operations",slotName:"operations"}]),H=(...r)=>R(this,[...r],function*(s={page:1,page_size:20}){l(!0);try{const{data:V}=yield ma(s);i.value=V.list,U.current=s.page,U.total=V.total}catch(V){}finally{l(!1)}}),t=()=>{H($({page:f.current,page_size:f.pageSize},T.value))},e=s=>{D("doHandle",s)},w=s=>{H(M($({},f),{page:s}))};H();const I=(s,r)=>{_.value=s},S=(s,r,V)=>{s?C.value.splice(V,0,r):C.value=B.value.filter(E=>E.dataIndex!==r.dataIndex)},x=(s,r,V,E=!1)=>{const k=E?ae(s):s;return r>-1&&V>-1&&k.splice(r,1,k.splice(V,1,k[r]).pop()),k},Q=s=>{s&&na(()=>{const r=document.getElementById("tableSetting");new ua(r,{onEnd(V){const{oldIndex:E,newIndex:k}=V;x(C.value,E,k),x(B.value,E,k)}})})};return G(()=>N.value,s=>{C.value=ae(s),C.value.forEach((r,V)=>{r.checked=!0}),B.value=ae(C.value)},{deep:!0,immediate:!0}),G(()=>p.isRefresh,s=>{s&&H()}),(s,r)=>{const V=fe("Breadcrumb"),E=pe,k=ie,W=Qe,n=Ye,be=Ze,Z=We,ye=Ke,xe=sa,we=Xe,Ve=aa,ke=ia,Ce=ra,Ie=ea,Se=Je,he=oa,Pe=_e,Ue=ta("permission");return b(),z("div",ka,[a(V,{items:["商品管理"]}),a(Pe,{class:"general-card",style:{"padding-top":"20px"}},{default:o(()=>[a(Se,{style:{"margin-bottom":"16px"}},{default:o(()=>[a(n,{span:12},{default:o(()=>[a(W,null,{default:o(()=>[a(k,{type:"primary",onClick:e},{icon:o(()=>[a(E)]),default:o(()=>[r[0]||(r[0]=g(" 添加商品 "))]),_:1})]),_:1})]),_:1}),a(n,{span:12,style:{display:"flex","align-items":"center","justify-content":"end"}},{default:o(()=>[a(Z,{content:s.$t("searchTable.actions.refresh")},{default:o(()=>[m("div",{class:"action-icon",onClick:t},[a(be,{size:"18"})])]),_:1},8,["content"]),a(we,{onSelect:I},{content:o(()=>[(b(!0),z(J,null,Y(A.value,v=>(b(),q(xe,{key:v.value,value:v.value,class:ee({active:v.value===_.value})},{default:o(()=>[m("span",null,F(v.name),1)]),_:2},1032,["value","class"]))),128))]),default:o(()=>[a(Z,{content:s.$t("searchTable.actions.density")},{default:o(()=>[m("div",Ca,[a(ye,{size:"18"})])]),_:1},8,["content"])]),_:1}),a(Z,{content:s.$t("searchTable.actions.columnSetting")},{default:o(()=>[a(Ie,{trigger:"click",position:"bl",onPopupVisibleChange:Q},{content:o(()=>[m("div",Sa,[(b(!0),z(J,null,Y(B.value,(v,$e)=>(b(),z("div",{key:v.dataIndex,class:"setting"},[m("div",ha,[a(ke)]),m("div",null,[a(Ce,{modelValue:v.checked,"onUpdate:modelValue":X=>v.checked=X,onChange:X=>S(X,v,$e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),m("div",Pa,F(v.title==="#"?"序列号":v.title),1)]))),128))])]),default:o(()=>[m("div",Ia,[a(Ve,{size:"18"})])]),_:1})]),_:1},8,["content"])]),_:1})]),_:1}),a(he,{"row-key":"id",loading:O(h),pagination:U,columns:C.value,data:i.value,bordered:!1,size:_.value,onPageChange:w},{onlineStatus:o(({record:v})=>[m("div",{class:ee([v.onlineStatus==="offline"?"not-pass":"pass"])},[r[1]||(r[1]=m("span",{class:"circle"},null,-1)),g(" "+F(s.$t(`searchTable.form.status.${v.onlineStatus}`)),1)],2)]),updated_at:o(({record:v})=>[m("div",null,F(O(la)(v.updated_at*1e3).format("YYYY-MM-DD HH:mm:ss")),1)]),productStatus:o(({record:v})=>[m("div",{class:ee([v.status==="offline"?"not-pass":"pass"])},[r[2]||(r[2]=m("span",{class:"circle"},null,-1)),g(" "+F(v.status==="offline"?"未上线":"上线"),1)],2)]),operations:o(({record:v})=>[ve((b(),q(k,{type:"text",size:"small",onClick:()=>{e(v)}},{default:o(()=>r[3]||(r[3]=[g(" 详情 ")])),_:2},1032,["onClick"])),[[Ue,["admin"]]])]),_:1},8,["loading","pagination","columns","data","size"])]),_:1})])}}})),za=re($a,[["__scopeId","data-v-8e9b3b40"]]),Ta={class:"container"},Ba={__name:"index",setup(c){const d=P(!1),u=P(null),D=p=>{console.log("info:",p),d.value=!0,u.value=p};return(p,h)=>(b(),z("div",Ta,[ve(a(za,{"is-refresh":!d.value,onDoHandle:D},null,8,["is-refresh"]),[[da,!d.value]]),d.value?(b(),q(Va,{key:0,"product-info":u.value,onCancelHandle:h[0]||(h[0]=()=>{d.value=!1})},null,8,["product-info"])):le("",!0)]))}},Ka=re(Ba,[["__scopeId","data-v-46853a70"]]);export{Ka as default};
